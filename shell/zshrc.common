# Vedran's Zsh Configuration - Common Settings
# Shared across macOS, Linux, and WSL

# Path to oh-my-zsh installation
export ZSH="$HOME/.oh-my-zsh"

# Plugins (installed by setup script)
plugins=(
    git
    zsh-autosuggestions
    zsh-syntax-highlighting
    colored-man-pages
    command-not-found
)

# Load Oh My Zsh if installed
[[ -d "$ZSH" ]] && source "$ZSH/oh-my-zsh.sh"

# Environment
export LANG=en_US.UTF-8
export EDITOR='nvim'

# Shell aliases
alias reload="source ~/.zshrc"
alias ezsh="$EDITOR ~/.zshrc"
alias vim='nvim'

# Directory navigation
alias ..="cd .. && pwd"
alias ...="cd ../.."
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'

# Project navigation
alias cdg='cd ~/Documents/github'
alias cdgv='cd ~/Documents/github/vblazenka'
alias cdp='cd ~/Documents/projects'
alias cds='cd ~/Documents/scripts'
alias cdn='cd ~/Documents/notes'

# Git shortcuts
alias g="git"
alias gp="g pull"
alias gs="g status"
alias gb="g branch"
alias gaa="g add ."
alias gc="g commit -m"
alias gr="g rebase master"
alias grc="g add . && git rebase --continue"
alias gch="git checkout"
alias gl="git log"
alias glog="git log --oneline --graph --decorate"

# Claude Code
alias c='claude'
alias cc='claude -c'

# Python/UV aliases
alias py='python3'
alias pip='pip3'
alias uvi='uv init'
alias uva='uv add'
alias uvr='uv run'
alias uvs='uv sync'
alias uvl='uv lock'
alias uvt='uv tool install'
alias uvp='uv python install'

# List scripts from nearest package.json in current git repo
scripts() {
    local root
    root=$(git rev-parse --show-toplevel 2>/dev/null) || root="."
    local pkg="$root/package.json"
    if [[ -f "$pkg" ]]; then
        echo "Scripts in package.json:"
        node -e "
            const s = JSON.parse(require('fs').readFileSync(process.argv[1],'utf8')).scripts || {};
            const entries = Object.entries(s);
            if (!entries.length) { console.log('  (no scripts defined)'); process.exit(); }
            const max = Math.max(...entries.map(([k]) => k.length));
            entries.forEach(([k, v]) => console.log('  \x1b[36m' + k.padEnd(max + 2) + '\x1b[0m' + v));
        " "$pkg"
    else
        echo "No package.json found in repository root"
    fi
}

# Kill process on a given port
kp() {
    if [[ -z "$1" ]]; then
        echo "Usage: kp <port>"
        return 1
    fi
    local pid
    pid=$(lsof -ti :"$1" 2>/dev/null)
    if [[ -z "$pid" ]]; then
        echo "No process found on port $1"
        return 1
    fi
    echo "Killing PID $pid on port $1"
    kill -9 $pid
}

# Copy file contents to clipboard
copyfile() {
    if [[ -z "$1" ]]; then
        echo "Usage: copyfile <file>"
        return 1
    fi
    if [[ ! -f "$1" ]]; then
        echo "File not found: $1"
        return 1
    fi
    if command -v pbcopy &>/dev/null; then
        cat "$1" | pbcopy
    elif command -v xclip &>/dev/null; then
        cat "$1" | xclip -selection clipboard
    elif command -v xsel &>/dev/null; then
        cat "$1" | xsel --clipboard
    elif command -v clip.exe &>/dev/null; then
        cat "$1" | clip.exe
    else
        echo "No clipboard tool found"
        return 1
    fi
    echo "Copied contents of $1 to clipboard"
}

# Custom prompt
function parse_git_branch() {
    git branch 2> /dev/null | sed -n -e 's/^\* \(.*\)/[\1]/p'
}

setopt PROMPT_SUBST
PROMPT='%F{cyan}$%f $(parse_git_branch): '

# Common PATH additions
export PATH="$HOME/.local/bin:$PATH"

# NVM configuration (location is same on all platforms)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && . "$NVM_DIR/bash_completion"
